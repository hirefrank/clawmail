#:schema node_modules/wrangler/config-schema.json
name = "clawmail"
main = "src/index.ts"
compatibility_date = "2025-04-01"
compatibility_flags = ["nodejs_compat"]

# --- D1 Database ---
# Create with: wrangler d1 create clawmail-db
# Then paste the database_id below
[[d1_databases]]
binding = "DB"
database_name = "clawmail-db"
database_id = "your-database-id"
migrations_dir = "migrations"

# --- R2 Bucket ---
# Create with: wrangler r2 bucket create clawmail-attachments
[[r2_buckets]]
binding = "ATTACHMENTS"
bucket_name = "clawmail-attachments"

# --- Durable Objects ---
# McpAgent for MCP server
[durable_objects]
bindings = [
  { name = "MCP_OBJECT", class_name = "EmailMCP" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["EmailMCP"]

# --- Environment Variables ---
[vars]
FROM_EMAIL = "noreply@yourdomain.com"
FROM_NAME = "Clawmail"
REPLY_TO_EMAIL = "reply@yourdomain.com"

# Optional: Webhook URL to POST on inbound email (message.received event)
# WEBHOOK_URL = "https://your-app.com/webhook"

# --- Secrets ---
# Set these with:
#   wrangler secret put API_KEY
#   wrangler secret put RESEND_API_KEY
#   wrangler secret put WEBHOOK_SECRET          (optional: HMAC signing key for outbound webhooks)
#   wrangler secret put RESEND_WEBHOOK_SECRET   (optional: token for Resend delivery status webhooks)

# --- Resend Delivery Webhooks ---
# To track delivery status (sent/delivered/bounced/complained):
#   1. Set RESEND_WEBHOOK_SECRET via `wrangler secret put RESEND_WEBHOOK_SECRET`
#   2. In Resend dashboard → Webhooks → Add endpoint:
#      URL: https://your-worker.dev/webhooks/resend?token=YOUR_SECRET
#      Events: email.sent, email.delivered, email.bounced, email.complained

# --- Email Routing ---
# Configure in Cloudflare dashboard:
#   Email Routing → Routing rules → forward to this Worker

# --- Observability ---
[observability]
enabled = true
